<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± - Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</title>
    <!-- Ù…ÙƒØªØ¨Ø© QR Code (Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> -->
    <!-- Ù…ÙƒØªØ¨Ø© PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            min-height: 100vh;
            color: white;
        }
        
        .classroom-card {
            transition: all 0.3s ease;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 110px;
            display: flex;
            flex-direction: column;
            padding: 8px;
            font-size: 0.85rem;
            position: relative;
        }
        
        .classroom-empty {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
            color: #5d4037;
        }
        
        .classroom-absent {
            background: linear-gradient(135deg, #ef5350 0%, #d32f2f 100%);
            color: white;
        }
        
        .classroom-present {
            background: linear-gradient(135deg, #66bb6a 0%, #388e3c 100%);
            color: white;
        }
        
        .time-table {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: #333;
        }
        
        .departure-board {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .current-time {
            font-size: 2.2rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .marquee {
            animation: marquee 30s linear infinite;
            white-space: nowrap;
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .room-name {
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 3px;
        }
        
        .professor-name {
            font-weight: 600;
            text-align: center;
            margin: 2px 0;
            font-size: 0.85rem;
        }
        
        .course-name {
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.9;
            margin: 2px 0;
        }
        
        .department-group {
            text-align: center;
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        .departure-board {
            background: rgba(0, 0, 0, 0.85) !important;
            border: 2px solid #00ff00 !important;
            font-family: 'Courier New', monospace !important;
            overflow: hidden !important;
            position: relative !important;
        }

        /* Ø­Ø±ÙƒØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø£Ø¹Ù„Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
        @keyframes scrollUp {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        .departure-board tbody {
            animation: scrollUp 30s linear infinite;
        }

        .departure-board tbody:hover {
            animation-play-state: paused;
        }

        /* Ø£Ø¹Ù…Ø¯Ø© Ø£ÙˆØ³Ø¹ Ù„Ù„Ù…Ù‚ÙŠØ§Ø³ */
        .departure-board th:nth-child(3),
        .departure-board td:nth-child(3) { /* Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ */
            min-width: 120px !important; /* Ø£ÙˆØ³Ø¹ Ø¨ÙƒØ«ÙŠØ± */
            max-width: 150px !important;
            text-align: right;
        }

        /* Ø£Ø¹Ù…Ø¯Ø© Ø£Ø¶ÙŠÙ‚ Ù„Ù„Ø¨Ù‚ÙŠØ© */
        .departure-board th:nth-child(1),
        .departure-board td:nth-child(1) { /* Ø§Ù„ÙˆÙ‚Øª */
            width: 70px !important;
            text-align: center;
        }

        .departure-board th:nth-child(2),
        .departure-board td:nth-child(2) { /* Ø§Ù„Ù‚Ø§Ø¹Ø© */
            width: 50px !important;
            text-align: center;
        }

        .departure-board th:nth-child(4),
        .departure-board td:nth-child(4) { /* Ø§Ù„Ø£Ø³ØªØ§Ø° */
            width: 140px !important;
            text-align: right;
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ£Ù„Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø± */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #00ff00; }
            50% { box-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00; }
        }

        .departure-board {
            animation: glow 3s infinite;
        }
        
        .time-slot-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0,0,0,0.3);
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .slot-1 { background: #4CAF50; }
        .slot-2 { background: #2196F3; }
        .slot-3 { background: #FF9800; }
        .slot-4 { background: #9C27B0; }
        .slot-5 { background: #795548; }
        
        /* ØªØ­Ø¯ÙŠØ«: ØªÙƒØ¨ÙŠØ± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª */
        .schedule-container {
            max-height: 350px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="p-2">
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 max-w-md w-full shadow-2xl">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-chalkboard-teacher text-blue-600"></i>
                    Ù†Ø¸Ø§Ù… Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
                </h1>
                <p class="text-gray-600 text-sm">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø´Ø±</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-1 text-sm font-medium">ğŸ« Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„ÙŠØ©</label>
                    <select id="faculty" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª...</option>
                    </select>
                </div>
                
                <div id="loginMessage" class="hidden p-2 rounded-lg text-xs"></div>
                
                <button onclick="startDisplay()" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition duration-300 font-bold">
                    <i class="fas fa-play mr-2"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
                </button>
            </div>
            
            <div class="mt-4 text-center text-gray-500 text-xs">
                <p>Â© 2024 Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¨Ø´ÙŠØ± Ø§Ù„Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…ÙŠ - Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬</p>
                <p class="mt-1">Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ Ø¯Ø§Ø®Ù„ÙŠØ© - ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±</p>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainPage" class="hidden">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-3 gap-2">
            <div class="text-center md:text-right">
                <h1 id="currentFaculty" class="text-lg md:text-xl font-bold flex items-center gap-2 justify-center md:justify-start">
                    <i class="fas fa-university text-yellow-400"></i>
                    <span id="facultyName" class="truncate">ÙƒÙ„ÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø§Ù†Ø³Ø§Ù†ÙŠØ©</span>
                </h1>
                <p class="text-gray-300 text-xs">Ù†Ø¸Ø§Ù… Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø­ÙŠØ©</p>
            </div>
            
            <div class="text-center">
                <div class="current-time" id="currentTime">00:00:00</div>
                <div class="text-gray-300 text-xs" id="currentDate">Ø§Ù„Ø¬Ù…Ø¹Ø© 15 Ù…Ø§Ø±Ø³ 2024</div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="changeTimeSlot(-1)" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded-lg text-xs">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <span id="currentTimeSlotDisplay" class="bg-blue-800 px-3 py-1 rounded-lg text-sm font-bold">8:00-9:30</span>
                <button onclick="changeTimeSlot(1)" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded-lg text-xs">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button onclick="refreshData(true)" id="refreshBtn" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded-lg text-xs">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-3">
            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø±: Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª -->
            <div class="lg:col-span-3">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center gap-2">
                        <h2 class="text-base md:text-lg font-bold">
                            <i class="fas fa-door-open"></i> Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
                        </h2>
                        <div class="flex gap-1">
                            <div class="flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                <span class="text-xs">Ø­Ø§Ø¶Ø±</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-red-500"></span>
                                <span class="text-xs">ØºØ§Ø¦Ø¨</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
                                <span class="text-xs">Ø´Ø§ØºØ±Ø©</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs bg-blue-900 px-2 py-1 rounded-lg">
                        Ø§Ù„ÙŠÙˆÙ…: <span id="currentDayDisplay" class="font-bold">Ø§Ù„Ø³Ø¨Øª</span>
                    </div>
                </div>

                <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª -->
                <div id="classroomsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-7 gap-1.5">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
                </div>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Ù…Ø¹Ø¯Ù„) -->
            <div class="space-y-3">
                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª (Ù…ÙˆØ³Ø¹) -->
                <div class="time-table p-3 schedule-container">
                    <h3 class="text-base font-bold mb-3 text-center text-gray-800">
                        <i class="fas fa-clock"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª - Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„
                    </h3>
                    <div class="departure-board p-3 rounded-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-green-400 border-b border-green-400">
                                        <th class="py-2 px-2">Ø§Ù„ÙˆÙ‚Øª</th>
                                        <th class="py-2 px-2">Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
                                        <th class="py-2 px-2">Ø§Ù„Ù…Ù‚ÙŠØ§Ø³</th>
                                        <th class="py-2 px-2">Ø§Ù„Ø£Ø³ØªØ§Ø°</th>
                                        <th class="py-2 px-2">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleTable">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-gray-600 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù„ÙŠ Ù„Ù„ØºÙŠØ§Ø¨: ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ (ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©)
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <div class="bg-gray-900 p-3 rounded-lg">
                    <h4 class="text-sm font-bold mb-2 text-center">
                        <i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©
                    </h4>
                    <div class="grid grid-cols-2 gap-2 text-center">
                        <div class="bg-gray-800 p-2 rounded">
                            <div class="text-xl font-bold text-blue-400" id="totalClassrooms">0</div>
                            <div class="text-xs text-gray-300">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</div>
                        </div>
                        <div class="bg-gray-800 p-2 rounded">
                            <div class="text-xl font-bold text-yellow-400" id="occupiedClassrooms">0</div>
                            <div class="text-xs text-gray-300">Ù…Ø­Ø¬ÙˆØ²Ø©</div>
                        </div>
                        <div class="bg-gray-800 p-2 rounded">
                            <div class="text-xl font-bold text-red-400" id="absentClassrooms">0</div>
                            <div class="text-xs text-gray-300">ØºØ§Ø¦Ø¨</div>
                        </div>
                        <div class="bg-gray-800 p-2 rounded">
                            <div class="text-xl font-bold text-green-400" id="presentClassrooms">0</div>
                            <div class="text-xs text-gray-300">Ø­Ø§Ø¶Ø±</div>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-gray-400 text-center">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdateTime">--:--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
        <div class="mt-3 bg-black p-1.5 rounded-lg overflow-hidden">
            <div class="marquee whitespace-nowrap">
                <span class="text-green-400 font-bold mx-2">ğŸ“ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¨Ø´ÙŠØ± Ø§Ù„Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…ÙŠ - Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬</span>
                <span class="text-yellow-400 mx-2" id="dateMarquee">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <span class="text-blue-400 mx-2">â° Ø§Ù„ØªÙˆÙ‚ÙŠØª: <span id="marqueeTime">00:00</span></span>
                <span class="text-red-400 mx-2">âš ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø­Ø§Ø¶Ø±ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ - ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØºÙŠØ§Ø¨ ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ</span>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const CONFIG_SHEET_ID = '1bh6oUXadE386uTDAFq75UmfcdtfQTzavucpwUeLah4o';
        
        // ØªÙˆÙ‚ÙŠØªØ§Øª Ø§Ù„ÙŠÙˆÙ…
        const TIME_SLOTS = [
            { id: 1, time: '09:30 - 08:00' },
            { id: 2, time: '11:00 - 09:30' },
            { id: 3, time: '12:30 - 11:00' },
            { id: 4, time: '14:00 - 12:30' },
            { id: 5, time: '15:30 - 14:00' },
            { id: 6, time: '17:00 - 15:30' }
        ];
        
        // Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const DAYS_ARABIC = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentFaculty = null;
        let facultySheetId = null;
        let currentSemester = null;
        let currentDay = '';
        let currentTimeSlot = 1;
        let scheduleData = [];
        let absentProfessors = new Set(); // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† ÙÙ‚Ø·
        let attendanceRefreshTimer = null;
        let lastUpdateTime = null;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            loadFaculties();
        });
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª
        async function loadFaculties() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${CONFIG_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=users`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                const select = document.getElementById('faculty');
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„ÙŠØ©</option>';
                
                const lines = csvText.split('\n');
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const columns = parseCSVLine(line);
                    if (columns.length >= 6 && columns[2] === '1') { // role = 1 (Ø¹Ù…ÙŠØ¯)
                        const facultyName = columns[3];
                        const sheetId = columns[5];
                        
                        if (facultyName && sheetId) {
                            const option = document.createElement('option');
                            option.value = JSON.stringify({ name: facultyName, sheetId: sheetId });
                            option.textContent = facultyName;
                            select.appendChild(option);
                        }
                    }
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª', 'error');
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø³Ø·Ø± CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† base
        async function loadFacultyBase(sheetId) {
            try {
                console.log('ğŸ” Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø³Ø¯Ø§Ø³ÙŠ Ù…Ù† base...');
                
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=base`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                const lines = csvText.split('\n').filter(line => line.trim() !== '');
                
                if (lines.length < 2) {
                    console.log('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ©');
                    return '2025_2026_s2';
                }
                
                // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                const headers = parseCSVLine(lines[0]);
                const semesterIndex = headers.findIndex(header => 
                    header && header.trim().toLowerCase() === 'anne_semester'
                );
                
                if (semesterIndex === -1) {
                    console.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ anne_semester');
                    return '2025_2026_s2';
                }
                
                // Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø¹Ù† Ø£ÙˆÙ„ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ÙØ§Ø±ØºØ©
                for (let i = lines.length - 1; i >= 1; i--) {
                    const columns = parseCSVLine(lines[i]);
                    if (columns.length > semesterIndex) {
                        const semester = columns[semesterIndex]?.trim();
                        if (semester && semester !== '') {
                            console.log('âœ… ÙˆØ¬Ø¯Ù†Ø§ Ø¢Ø®Ø± Ø³Ø¯Ø§Ø³ÙŠ ØºÙŠØ± ÙØ§Ø±Øº:', semester);
                            return semester;
                        }
                    }
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ÙØ§Ø±ØºØ©ØŒ Ù†Ø¹ÙˆØ¯ Ù„Ù„Ø£ÙˆÙ„Ù‰
                const firstDataLine = parseCSVLine(lines[1]);
                const defaultSemester = firstDataLine[semesterIndex] || '2025_2026_s2';
                console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆÙ„ Ù‚ÙŠÙ…Ø© ÙƒØ¨Ø¯ÙŠÙ„:', defaultSemester);
                
                return defaultSemester;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª base:', error);
                return '2025_2026_s2';
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹
        async function loadSchedule(sheetId, semesterPage) {
            try {
                const today = new Date();
                const dayName = DAYS_ARABIC[today.getDay()];
                currentDay = dayName;

                // ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(semesterPage)}`;
                const response = await fetch(url);
                const csvText = await response.text();

                if (csvText.startsWith('Error')) {
                    console.error('âŒ ØµÙØ­Ø© Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©:', semesterPage);
                    return [];
                }

                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ:', semesterPage);
                return parseScheduleCSV(csvText, dayName);

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹:', error);
                return [];
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ CSV
        function parseScheduleCSV(csvText, dayName) {
            const schedule = [];
            const lines = csvText.split('\n');
            
            if (lines.length < 2) {
                console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„');
                return schedule;
            }
            
            // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            const headers = parseCSVLine(lines[0]);
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            const findColumnIndex = (columnNames) => {
                for (const name of columnNames) {
                    for (let i = 0; i < headers.length; i++) {
                        if (headers[i] && headers[i].trim() === name) {
                            return i;
                        }
                    }
                }
                return -1;
            };
            
            const Ù‚Ø³Ù…Index = findColumnIndex(['Ø§Ù„Ù‚Ø³Ù…', 'department']) || 0;
            const ØªØ®ØµØµIndex = findColumnIndex(['Ø§Ù„ØªØ®ØµØµ', 'specialization', 'specialite']) || 1;
            const Ù…Ù‚ÙŠØ§Ø³Index = findColumnIndex(['Ø§Ù„Ù…Ù‚ÙŠØ§Ø³', 'course', 'matiere']) || 2;
            const Ø­ØµØ©Index = findColumnIndex(['Ø§Ù„Ø­ØµØ©', 'group', 'groupe']) || 3;
            const Ø§Ø³ØªØ§Ø°Index = findColumnIndex(['Ø§Ù„Ø§Ø³ØªØ§Ø°', 'professor', 'prof']) || 4;
            const ÙŠÙˆÙ…Index = findColumnIndex(['Ø§Ù„ÙŠÙˆÙ…', 'day', 'jour']) || 5;
            const ØªÙˆÙ‚ÙŠØªIndex = findColumnIndex(['Ø§Ù„ØªÙˆÙ‚ÙŠØª', 'time', 'temps', 'heure']) || 6;
            const Ù‚Ø§Ø¹Ø©Index = findColumnIndex(['Ø§Ù„Ù‚Ø§Ø¹Ø©', 'classroom', 'salle']) || 7;
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø·ÙˆØ± (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = parseCSVLine(line);
                
                if (columns.length >= 2) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙŠÙˆÙ… ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                    const dayValue = columns[ÙŠÙˆÙ…Index] ? columns[ÙŠÙˆÙ…Index].trim() : '';
                    
                    if (dayValue === dayName) {
                        const item = {
                            Ø§Ù„Ù‚Ø³Ù…: columns[Ù‚Ø³Ù…Index] || '',
                            Ø§Ù„ØªØ®ØµØµ: columns[ØªØ®ØµØµIndex] || '',
                            Ø§Ù„Ù…Ù‚ÙŠØ§Ø³: columns[Ù…Ù‚ÙŠØ§Ø³Index] || '',
                            Ø§Ù„Ø­ØµØ©: columns[Ø­ØµØ©Index] || '',
                            Ø§Ù„Ø§Ø³ØªØ§Ø°: columns[Ø§Ø³ØªØ§Ø°Index] || '',
                            Ø§Ù„ÙŠÙˆÙ…: dayValue,
                            Ø§Ù„ØªÙˆÙ‚ÙŠØª: columns[ØªÙˆÙ‚ÙŠØªIndex] || '',
                            Ø§Ù„Ù‚Ø§Ø¹Ø©: columns[Ù‚Ø§Ø¹Ø©Index] || '',
                            isPresent: true // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø­Ø§Ø¶Ø±
                        };
                        
                        schedule.push(item);
                    }
                }
            }
            
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©:', schedule.length);
            return schedule;
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† ÙÙ‚Ø· (ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ)
        async function loadAbsentProfessors(sheetId) {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=profs`;
                const response = await fetch(url);
                const csvText = await response.text();

                const absentSet = new Set();
                const today = new Date();
                const todayISO = today.toISOString().split('T')[0];
                const todayDMY = today.toLocaleDateString('en-GB');
                const todayMD = `${today.getDate().toString().padStart(2,'0')}/${(today.getMonth()+1).toString().padStart(2,'0')}`;

                // Ø§Ø³ØªØ®Ø¯Ø§Ù… PapaParse
                const parsed = Papa.parse(csvText, { skipEmptyLines: true });
                const rows = parsed.data;

                if (!rows || rows.length < 2) return absentSet;

                // Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                const headers = rows[0].map(h => h.trim().toLowerCase());

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§Ø³Ù…
                const nameCandidates = ['name','Ø§Ù„Ø§Ø³Ù…','Ø§Ù„Ø£Ø³ØªØ§Ø°','professor','teacher'];
                const nameIndex = headers.findIndex(h => nameCandidates.includes(h));

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±
                const attendanceCandidates = ['attendance','Ø§Ù„Ø­Ø¶ÙˆØ±','presence'];
                const attendanceIndex = headers.findIndex(h => attendanceCandidates.includes(h));

                if (nameIndex === -1 || attendanceIndex === -1) {
                    console.error('âŒ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
                    return absentSet;
                }

                // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ ØµÙ
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];

                    const professorName = (row[nameIndex] || '').trim();
                    const attendanceCell = (row[attendanceIndex] || '').trim();

                    if (!professorName) continue;

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ§Ø±ÙŠØ® ÙÙŠ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ÙØ¥Ù† Ø§Ù„Ø£Ø³ØªØ§Ø° ØºØ§Ø¦Ø¨
                    if (attendanceCell) {
                        const cleaned = attendanceCell.replace(/[\[\]{}"]/g,'');
                        const dates = cleaned.split(/[,;]+/).map(d => d.trim());

                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙŠ ØªØ§Ø±ÙŠØ® ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙŠÙˆÙ…
                        for (const d of dates) {
                            if (d.includes(todayISO) || d.includes(todayDMY) || d.includes(todayMD)) {
                                absentSet.add(professorName);
                                console.log(`âŒ ${professorName} - ØºØ§Ø¦Ø¨`);
                                break;
                            }
                        }
                    }
                }

                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${absentSet.size} Ø£Ø³ØªØ§Ø° ØºØ§Ø¦Ø¨`);
                return absentSet;

            } catch (err) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨:', err);
                return new Set();
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ©
        async function loadMakeupClasses(sheetId) {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=ratrape`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                return parseMakeupCSV(csvText);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ©:', error);
                return [];
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ©
        function parseMakeupCSV(csvText) {
            const makeupClasses = [];
            const lines = csvText.split('\n');
            
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();
            
            if (lines.length < 2) return makeupClasses;
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = parseCSVLine(line);
                
                if (columns.length >= 9) {
                    const classDate = columns[4] || '';
                    
                    const dateParts = classDate.split('-');
                    if (dateParts.length === 3) {
                        const classYear = parseInt(dateParts[0]);
                        const classMonth = parseInt(dateParts[1]);
                        const classDay = parseInt(dateParts[2]);
                        
                        if (classYear === currentYear && classMonth === currentMonth && classDay === currentDay) {
                            const item = {
                                Ø§Ù„Ù‚Ø³Ù…: columns[0] || '',
                                Ø§Ù„ØªØ®ØµØµ: columns[1] || '',
                                Ø§Ù„Ø­ØµØ©: columns[2] || '',
                                Ø§Ù„Ù…Ù‚ÙŠØ§Ø³: columns[3] || '',
                                Ø§Ù„ØªØ§Ø±ÙŠØ®: classDate,
                                Ø§Ù„ÙŠÙˆÙ…: columns[5] || '',
                                Ø§Ù„ØªÙˆÙ‚ÙŠØª: columns[6] || '',
                                Ø§Ù„Ù‚Ø§Ø¹Ø©: columns[7] || '',
                                Ø§Ù„Ø§Ø³ØªØ§Ø°: columns[8] || '',
                                isMakeup: true,
                                isPresent: true // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø­Ø§Ø¶Ø±
                            };
                            
                            makeupClasses.push(item);
                        }
                    }
                }
            }
            
            console.log('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…:', makeupClasses.length);
            return makeupClasses;
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
        async function startDisplay() {
            const facultySelect = document.getElementById('faculty');
            const selectedValue = facultySelect.value;
            
            if (!selectedValue) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„ÙŠØ©', 'error');
                return;
            }
            
            try {
                const facultyData = JSON.parse(selectedValue);
                currentFaculty = facultyData.name;
                facultySheetId = facultyData.sheetId;
                
                showMessage('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
                
                // Ø¬Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                currentSemester = await loadFacultyBase(facultySheetId);
                console.log('Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', currentSemester);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('facultyName').textContent = currentFaculty;
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await loadAllData();
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØºÙŠØ§Ø¨ ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ
                startAbsenceAutoRefresh();
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainPage').classList.remove('hidden');
                
                showMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadAllData() {
            try {
                // Ø¬Ù„Ø¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                scheduleData = await loadSchedule(facultySheetId, currentSemester);
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ©
                const makeupClasses = await loadMakeupClasses(facultySheetId);
                
                // Ø¯Ù…Ø¬ Ø§Ù„Ø­ØµØµ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ© Ù…Ø¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                scheduleData = [...scheduleData, ...makeupClasses];
                
                console.log('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬:', scheduleData.length);
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† ÙÙ‚Ø·
                absentProfessors = await loadAbsentProfessors(facultySheetId);
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ scheduleData Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØºÙŠØ§Ø¨
                updateAttendanceStatus();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                updateDisplay();
                
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØºÙŠØ§Ø¨
        function updateAttendanceStatus() {
            scheduleData.forEach(lecture => {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø³ØªØ§Ø° ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†
                if (absentProfessors.has(lecture.Ø§Ù„Ø§Ø³ØªØ§Ø°)) {
                    lecture.isPresent = false;
                } else {
                    lecture.isPresent = true; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø­Ø§Ø¶Ø±
                }
            });
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØºÙŠØ§Ø¨ ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ
        function startAbsenceAutoRefresh() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚
            if (attendanceRefreshTimer) {
                clearInterval(attendanceRefreshTimer);
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 90 Ø¯Ù‚ÙŠÙ‚Ø© (Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ)
            attendanceRefreshTimer = setInterval(async () => {
                console.log('â° ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØºÙŠØ§Ø¨ (ÙƒÙ„ Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ)...');
                
                if (facultySheetId) {
                    try {
                        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ ÙÙ‚Ø·
                        absentProfessors = await loadAbsentProfessors(facultySheetId);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
                        updateAttendanceStatus();
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                        updateDisplay();
                        
                        // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                        updateLastUpdateTime();
                        
                        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                        
                    } catch (error) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
                    }
                }
            }, 90 * 60 * 1000); // 90 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            lastUpdateTime = now;
            document.getElementById('lastUpdateTime').textContent = timeStr;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        function updateDisplay() {
            updateClassroomsGrid();
            updateScheduleTable();
            updateStatistics();
            updateDayDisplay();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø¨ÙƒØ© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
        function updateClassroomsGrid() {
            const currentSlot = TIME_SLOTS[currentTimeSlot - 1];
            const grid = document.getElementById('classroomsGrid');
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©
            const uniqueRooms = new Set();
            scheduleData.forEach(item => {
                if (item.Ø§Ù„Ù‚Ø§Ø¹Ø© && item.Ø§Ù„Ù‚Ø§Ø¹Ø©.trim()) {
                    uniqueRooms.add(item.Ø§Ù„Ù‚Ø§Ø¹Ø©.trim());
                }
            });
            
            const roomsArray = Array.from(uniqueRooms).sort();
            grid.innerHTML = '';
            
            let presentCount = 0;
            let absentCount = 0;
            let occupiedCount = 0;
            
            roomsArray.forEach(room => {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø© Ù„Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
                const lecturesInRoom = scheduleData.filter(item => {
                    const matchesRoom = item.Ø§Ù„Ù‚Ø§Ø¹Ø© && item.Ø§Ù„Ù‚Ø§Ø¹Ø©.trim() === room;
                    const matchesDay = item.Ø§Ù„ÙŠÙˆÙ… && item.Ø§Ù„ÙŠÙˆÙ….trim() === currentDay;
                    const matchesTime = item.Ø§Ù„ØªÙˆÙ‚ÙŠØª && item.Ø§Ù„ØªÙˆÙ‚ÙŠØª.includes(currentSlot.time);
                    
                    return matchesRoom && matchesDay && matchesTime;
                });
                
                let status = 'empty'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø´Ø§ØºØ±Ø© (ØµÙØ±Ø§Ø¡)
                let lecture = null;
                
                if (lecturesInRoom.length > 0) {
                    lecture = lecturesInRoom[0];
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
                    if (lecture.isPresent === false) {
                        status = 'absent'; // ØºØ§Ø¦Ø¨ (Ø£Ø­Ù…Ø±)
                        absentCount++;
                    } else {
                        status = 'present'; // Ø­Ø§Ø¶Ø± (Ø£Ø®Ø¶Ø±)
                        presentCount++;
                    }
                    
                    occupiedCount++;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¹Ø©
                const card = createClassroomCard(room, status, lecture);
                grid.appendChild(card);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('totalClassrooms').textContent = roomsArray.length;
            document.getElementById('occupiedClassrooms').textContent = occupiedCount;
            document.getElementById('absentClassrooms').textContent = absentCount;
            document.getElementById('presentClassrooms').textContent = presentCount;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¹Ø©
        function createClassroomCard(roomName, status, lecture) {
            let statusClass, slotClass = '';
            
            switch(status) {
                case 'present':
                    statusClass = 'classroom-present';
                    slotClass = 'slot-1';
                    break;
                case 'absent':
                    statusClass = 'classroom-absent';
                    slotClass = 'slot-2';
                    break;
                default:
                    statusClass = 'classroom-empty';
                    slotClass = 'slot-3';
            }
            
            const card = document.createElement('div');
            card.className = `classroom-card ${statusClass}`;
            
            let content = `
                <div class="time-slot-badge ${slotClass}">
                    ${currentTimeSlot}
                </div>
                <div class="room-name">${roomName}</div>`;
            
            if (lecture) {
                const professorName = lecture.Ø§Ù„Ø§Ø³ØªØ§Ø° || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const courseName = lecture.Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ || 'Ø¨Ø¯ÙˆÙ† Ù…Ù‚ÙŠØ§Ø³';
                const department = lecture.Ø§Ù„ØªØ®ØµØµ || '';
                const group = lecture.Ø§Ù„Ø­ØµØ© || '';
                const isMakeup = lecture.isMakeup;
                const makeupBadge = isMakeup ? 
                    '<div class="absolute top-0 left-0 bg-purple-600 text-white text-xs px-1 rounded-bl">ØªØ¹ÙˆÙŠØ¶</div>' : '';
                
                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø³ØªØ§Ø° ØºØ§Ø¦Ø¨Ù‹Ø§
                const absentBadge = !lecture.isPresent ? 
                    '<div class="absolute top-0 left-8 bg-red-600 text-white text-xs px-1 rounded-bl">ØºØ§Ø¦Ø¨</div>' : '';
                
                content += `
                    ${makeupBadge}
                    ${absentBadge}
                    <div class="professor-name">
                        ${professorName}
                    </div>
                    <div class="course-name">
                        ${courseName}
                    </div>
                    <div class="department-group">
                        ${department} ${group ? '| ' + group : ''}
                    </div>`;
            } else {
                content += `
                    <div class="professor-name">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <div class="course-name">Ù‚Ø§Ø¹Ø© Ø´Ø§ØºØ±Ø©</div>
                    <div class="department-group">${currentDay}</div>`;
            }
            
            card.innerHTML = content;
            return card;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
        function updateScheduleTable() {
            const table = document.getElementById('scheduleTable');
            
            // Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            const todayLectures = scheduleData.filter(item => {
                return item.Ø§Ù„ÙŠÙˆÙ… && item.Ø§Ù„ÙŠÙˆÙ….trim() === currentDay;
            });
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            todayLectures.sort((a, b) => {
                const timeA = extractStartTime(a.Ø§Ù„ØªÙˆÙ‚ÙŠØª || '');
                const timeB = extractStartTime(b.Ø§Ù„ØªÙˆÙ‚ÙŠØª || '');
                return timeA - timeB;
            });
            
            table.innerHTML = '';
            
            if (todayLectures.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-green-400">â—¼ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ… â—¼</td></tr>';
                table.style.animation = 'none';
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
            todayLectures.forEach((lecture, index) => {
                const status = lecture.isPresent ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
                const statusColor = lecture.isPresent ? 'text-green-400' : 'text-red-400';
                const statusIcon = lecture.isPresent ? 'âœ…' : 'âŒ';
                
                const timeDisplay = formatTime(lecture.Ø§Ù„ØªÙˆÙ‚ÙŠØª || '');
                
                // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø§Ù„ÙŠ
                const isCurrentTime = isCurrentLecture(lecture.Ø§Ù„ØªÙˆÙ‚ÙŠØª || '');
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-green-900';
                
                if (isCurrentTime) {
                    row.className += ' bg-green-800 bg-opacity-50';
                }
                
                row.innerHTML = `
                    <td class="py-2 px-2 font-mono ${isCurrentTime ? 'text-yellow-300 font-bold' : 'text-green-300'} text-center">
                        ${timeDisplay}
                    </td>
                    <td class="py-2 px-2 ${isCurrentTime ? 'text-yellow-300 font-bold' : 'text-yellow-300'} text-center font-bold">
                        ${lecture.Ø§Ù„Ù‚Ø§Ø¹Ø© || '--'}
                    </td>
                    <td class="py-2 px-2 ${isCurrentTime ? 'text-yellow-300' : 'text-white'} text-right font-medium truncate" 
                        title="${lecture.Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ || ''}">
                        ${lecture.Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ || 'Ø¨Ø¯ÙˆÙ† Ù…Ù‚ÙŠØ§Ø³'}
                    </td>
                    <td class="py-2 px-2 ${isCurrentTime ? 'text-yellow-300' : 'text-white'} text-right font-mono truncate" 
                        title="${lecture.Ø§Ù„Ø§Ø³ØªØ§Ø° || ''}">
                        ${lecture.Ø§Ù„Ø§Ø³ØªØ§Ø° || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                    </td>
                    <td class="py-2 px-2 ${statusColor} text-center font-bold">
                        ${statusIcon} ${status}
                    </td>
                `;
                table.appendChild(row);
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† 5 Ù…Ø­Ø§Ø¶Ø±Ø§Øª
            if (todayLectures.length > 5) {
                const animationDuration = todayLectures.length * 3;
                table.style.animation = `scrollUp ${animationDuration}s linear infinite`;
            } else {
                table.style.animation = 'none';
            }
        }
        
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆÙ‚Øª
        function extractStartTime(timeStr) {
            if (!timeStr) return 0;
            
            try {
                const parts = timeStr.split(' - ');
                let timePart = parts[0];
                
                if (parts.length === 2) {
                    const time1 = convertTimeToMinutes(parts[0]);
                    const time2 = convertTimeToMinutes(parts[1]);
                    timePart = time1 < time2 ? parts[0] : parts[1];
                }
                
                return convertTimeToMinutes(timePart);
            } catch (e) {
                return 0;
            }
        }
        
        function convertTimeToMinutes(timeStr) {
            if (!timeStr) return 0;
            
            const time = timeStr.trim();
            const [hours, minutes] = time.split(':').map(Number);
            return (hours || 0) * 60 + (minutes || 0);
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return '--:--';
            
            const parts = timeStr.split(' - ');
            if (parts.length === 2) {
                return parts[1];
            }
            
            return timeStr;
        }
        
        function isCurrentLecture(timeStr) {
            if (!timeStr) return false;
            
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;
            
            const parts = timeStr.split(' - ');
            if (parts.length === 2) {
                const startTime = convertTimeToMinutes(parts[0]);
                const endTime = convertTimeToMinutes(parts[1]);
                
                return currentTime >= Math.min(startTime, endTime) && 
                       currentTime <= Math.max(startTime, endTime);
            }
            
            return false;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            // ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙÙŠ updateClassroomsGrid
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…
        function updateDayDisplay() {
            document.getElementById('currentDayDisplay').textContent = currentDay;
            document.getElementById('currentTimeSlotDisplay').textContent = TIME_SLOTS[currentTimeSlot - 1].time;
        }
        
        // ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª
        function changeTimeSlot(direction) {
            const newSlot = currentTimeSlot + direction;
            
            if (newSlot >= 1 && newSlot <= TIME_SLOTS.length) {
                currentTimeSlot = newSlot;
                updateDisplay();
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§
        async function refreshData(showMessageFlag = true) {
            const btn = document.getElementById('refreshBtn');
            if (btn) {
                const icon = btn.querySelector('i');
                const originalClass = icon.className;
                
                btn.disabled = true;
                icon.className = 'fas fa-spinner fa-spin';
                
                try {
                    await loadAllData();
                    if (showMessageFlag) {
                        showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    if (showMessageFlag) {
                        showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    }
                } finally {
                    setTimeout(() => {
                        btn.disabled = false;
                        icon.className = originalClass;
                    }, 1000);
                }
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
        function updateDateTime() {
            const now = new Date();
            
            // Ø§Ù„Ø³Ø§Ø¹Ø© Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const timeStr = now.toLocaleTimeString('en-GB', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            
            // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const dateStr = new Intl.DateTimeFormat('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }).format(now);
            
            const englishDate = dateStr
                .replace(/[Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©]/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d))
                .replace(/[Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d));
            
            // Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ø¨Ø¯ÙˆÙ† Ø«ÙˆØ§Ù†ÙŠ)
            const shortTime = now.toLocaleTimeString('en-GB', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø©
            document.getElementById('currentTime').textContent = timeStr;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
            document.getElementById('currentDate').textContent = englishDate;
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            document.getElementById('marqueeTime').textContent = shortTime;
            
            const dateMarquee = document.getElementById('dateMarquee');
            if (dateMarquee) {
                dateMarquee.textContent = `ğŸ“… ${englishDate}`;
            }
            
            // ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (currentFaculty) {
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTime = currentHour + currentMinute / 60;
                
                let newTimeSlot = 1;
                
                if (currentTime >= 8 && currentTime < 9.5) newTimeSlot = 1;
                else if (currentTime >= 9.5 && currentTime < 11) newTimeSlot = 2;
                else if (currentTime >= 11 && currentTime < 12.5) newTimeSlot = 3;
                else if (currentTime >= 12.5 && currentTime < 14) newTimeSlot = 4;
                else if (currentTime >= 14 && currentTime < 15.5) newTimeSlot = 5;
                else if (currentTime >= 15.5 && currentTime < 17) newTimeSlot = 6;
                
                if (newTimeSlot !== currentTimeSlot) {
                    currentTimeSlot = newTimeSlot;
                    updateDisplay();
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function showMessage(message, type) {
            const messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = message;
            messageDiv.className = '';
            
            switch(type) {
                case 'success':
                    messageDiv.className = 'bg-green-100 text-green-700 border border-green-300';
                    break;
                case 'error':
                    messageDiv.className = 'bg-red-100 text-red-700 border border-red-300';
                    break;
                case 'info':
                    messageDiv.className = 'bg-blue-100 text-blue-700 border border-blue-300';
                    break;
            }
            
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>